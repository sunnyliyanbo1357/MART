<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>MART - JSON Editor</title>

    <!-- placeholders for the theme switcher -->
    <link rel='stylesheet' id='theme_stylesheet'>
    <link rel='stylesheet' id='icon_stylesheet'>

    <style>[class*="foundicon-"] {font-family: GeneralFoundicons;font-style: normal;}</style>
    <script src='dist/jsoneditor.js'></script>
    <!-- // <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script> -->
    <script type="text/javascript"
        src="https://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>
    <script type="text/javascript" src="cron/jquery-cron.js"></script>
    <!-- <link type="text/css" href="cron/jquery-cron.css" rel="stylesheet" /> -->
    <script type="text/javascript" src="gentleSelect/jquery-gentleSelect.js"></script>
    <link type="text/css" href="gentleSelect/jquery-gentleSelect.css" rel="stylesheet" />

</head>
<body>
<div class='container'>
    <div class='row'>
        <div class='span8 col-md-8 columns eight large-8'>
            <h2>Mobile App Researcher Toolkit</h2>
            <p>Below is the editor generated from the JSON Schema.</p>

            <div id='editor'></div>
        </div>

        <div class='span4 col-md-4 columns four large-4'>

            <h2>JSON Output</h2>
            <p>You can also make changes to the JSON here and set the value in the editor by clicking <button class='btn btn-primary' id='setvalue'>Update Form</button></p>
            <textarea id='output' style='width: 100%; min-height: 2000px; overflow: auto; font-family: monospace;' class='form-control'></textarea>


            <h2>Validation</h2>
            <p>Show validation error messages if there is any.</p>
            <textarea id='validate' style='width: 100%; height: 200px; font-family: monospace;' readonly disabled class='form-control'></textarea>

            <h2>Cron</h2>
            <div id='selector'></div>
            <p>Copy this to scheduleString: <span class='cron-text' id='cron-val'></span></p>

            <!-- <textarea id='cron' style='width: 100%; min-height: 50px; font-family: monospace;' class='form-control'></textarea> -->
        </div>

        <div class='row'>
            <div class='span12 col-md-12 columns twelve large-12'>
            <!-- <div class='span12 col-md-12 columns twelve large-12'  style="display: none;"> -->
                <h2>Schema</h2>
                <p>You can change the schema and see how the generated form looks.  After you make changes, click <button class='btn btn-primary' id='setschema'>Update Schema</button></p>

                <textarea id='schema' style='width: 100%; height: 450px; font-family: monospace;' class='form-control'></textarea>
            </div>
        </div>

    </div>
</div>
<script>
(function() {
    var schema;
    // if(window.location.href.match('[?&]schema=([^&]+)')) {
    //     try {
    //         schema = JSON.parse(LZString.decompressFromBase64(window.location.href.match('[?&]schema=([^&]+)')[1]));
    //     }
    //     catch(e) {
    //         console.log('invalid starting schema');
    //     }
    // }
    // Default starting schema
    // if(!schema) {
        schema = {


  "title": "YADL Full/Spot Survey",
  "type": "object",
  "properties": {
    "YADL": {
      "properties": {
        "full": {
          "properties": {
            "identifier": {
              "type": "string",
              "description": "Activity Identifier",
              "minLength": 4,
              "default": "YADL Full Identifier"
            },
            "prompt": {
              "type": "string",
              "description": "Question in general",
              "default": "How hard is this activity for you on a difficult day?"
            },
            "summary": {
              "type": "object",
              "title": "summary",
              "properties": {
                "identifier": {
                  "type": "string",
                  "default": "YADL Full Summary Identifier"
                },
                "title": {
                  "type": "string",
                  "default": "Thanks"
                },
                "text": {
                  "type": "string",
                  "default": "Thank you for participating in the YADL Full Assessment"
                }
              }
            },
            "choices": {
              "type": "array",
              "format": "table",
              "title": "choices",
              "uniqueItems": true,
              "items": {
                "type": "object",
                "title": "Choice",
                "properties": {
                  "text": {
                    "type": "string",
                    "enum": [
                      "Easy",
                      "Moderate",
                      "Hard"
                    ],
                    "default": "Easy"
                  },
                  "value": {
                    "type": "string"
                  },
                  "color": {
                    "type": "string",
                    "format": "color",
                    "default": "#69D2E7"
                  }
                }
              },
              "default": [
                {
                  "text": "Easy",
                  "value": "easy",
                  "color": "#69D2E7"
                }
              ]
            }
          }
        },
        "spot": {
          "properties": {
            "identifier": {
              "type": "string",
              "description": "Activity Identifier",
              "minLength": 4,
              "default": "YADL Spot Identifier"
            },
            "prompt": {
              "type": "string",
              "description": "Question in general",
              "default": "Which activities did you have trouble with today?"
            },
            "summary": {
              "type": "object",
              "title": "summary",
              "properties": {
                "identifier": {
                  "type": "string",
                  "default": "YADL Spot Summary Identifier"
                },
                "title": {
                  "type": "string",
                  "default": "Thanks"
                },
                "text": {
                  "type": "string",
                  "default": "Thank you for participating in the YADL Spot Assessment"
                }
              }
            },
            "noItemsSummary": {
              "type": "object",
              "title": "noItemsSummary",
              "properties": {
                "identifier": {
                  "type": "string",
                  "default": "YADL Spot No Activities Summary Identifier"
                },
                "title": {
                  "type": "string",
                  "default": "Thanks"
                },
                "text": {
                  "type": "string",
                  "default": "You have no activities to measure"
                }
              }
            },
            "options": {
              "type": "object",
              "title": "options",
              "properties": {
                "somethingSelectedButtonColor": {
                  "type": "string",
                  "format": "color",
                  "default": "#0080ff"
                },
                "nothingSelectedButtonColor": {
                  "type": "string",
                  "format": "color",
                  "default": "#FCC103"
                },
                "itemCellSelectedColor": {
                  "type": "string",
                  "format": "color",
                  "default": "#7FEE7D"
                },
                "itemCellSelectedOverlayImageTitle": {
                  "type": "string",
                  "default": "rsb_ic_check"
                },
                "itemCollectionViewBackgroundColor": {
                  "type": "string",
                  "format": "color",
                  "default": "#E9E9E9"
                },
                "itemsPerRow": {
                  "type": "integer",
                  "default": 3,
                  "minimum": 1,
                  "maximum": 8
                },
                "itemMinSpacing": {
                  "type": "number",
                  "default": 10,
                  "minimum": 1,
                  "maximum": 30
                }
              }
            }
          }
        },
        "activities": {
          "type": "array",
          "format": "table",
          "title": "activities",
          "uniqueItems": true,
          "items": {
            "type": "object",
            "title": "activities",
            "properties": {
              "imageTitle": {
                "type": "string"
              },
              "description": {
                "type": "string"
              },
              "identifier": {
                "type": "string"
              }
            }
          },
          "default": [
            {
              "imageTitle": "bathing",
              "description": "Bathing",
              "identifier": "Bathing"
            }
          ]
        }
      }
    }
  }




}//schema
    // }//schema
    // Divs/textareas on the page
    var $schema = document.getElementById('schema');
    var $output = document.getElementById('output');
    var $editor = document.getElementById('editor');
    var $validate = document.getElementById('validate');

    // Buttons
    var $set_schema_button = document.getElementById('setschema');
    var $set_value_button = document.getElementById('setvalue');
    var jsoneditor;

    $('#selector').cron({
      initial: "42 3 * * 5",
      onChange: function() {
          $('#cron-val').text($(this).cron("value"));
      },
      useGentleSelect: true
    });
    var reload = function(keep_value) {
        var startval = (jsoneditor && keep_value)? jsoneditor.getValue() : window.startval;
        window.startval = undefined;
        if(jsoneditor) jsoneditor.destroy();
        jsoneditor = new JSONEditor($editor,{
            schema: schema,
            startval: startval
        });
        window.jsoneditor = jsoneditor;
        // When the value of the editor changes, update the JSON output and validation message
        jsoneditor.on('change',function() {
            var json = jsoneditor.getValue();
            $output.value = JSON.stringify(json,null,2);
            var validation_errors = jsoneditor.validate();
            // Show validation errors if there are any
            if(validation_errors.length) {
                $validate.value = JSON.stringify(validation_errors,null,2);
            }
            else {
                $validate.value = 'valid';
            }
        });
    };
    // Start the schema and output textareas with initial values
    $schema.value = JSON.stringify(schema,null,2);
    $output.value = '';
    // When the 'update form' button is clicked, set the editor's value
    $set_value_button.addEventListener('click',function() {
        jsoneditor.setValue(JSON.parse($output.value));
    });
    // Update the schema when the button is clicked
    $set_schema_button.addEventListener('click',function() {
        try {
            schema = JSON.parse($schema.value);
        }
        catch(e) {
            alert('Invalid Schema: '+e.message);
            return;
        }
        reload();
    });

    // Set the theme by loading the right stylesheets
    // Get starting value from url
    if(window.location.href.match('[?&]value=([^&]+)')) {
      window.startval = JSON.parse(LZString.decompressFromBase64(window.location.href.match('[?&]value=([^&]+)')[1]));
    }
    // Set options from direct link
    JSONEditor.defaults.options.theme = 'bootstrap2';
    document.getElementById('theme_stylesheet').href = '//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css';
    JSONEditor.defaults.options.iconlib = 'fontawesome4';
    document.getElementById('icon_stylesheet').href = '//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.css';
    JSONEditor.defaults.options.object_layout = 'normal';
    JSONEditor.defaults.options.show_errors = 'interaction';
    reload();
})();
</script>
</body>
</html>